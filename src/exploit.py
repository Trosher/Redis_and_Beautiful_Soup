import bs4
import requests
import webbrowser 

def getPage():
    res = ""
    try:
        with open('../materials/evilcorp.html', 'r') as file:
            res = file.read()
    except Exception:
        print("File cannot be opened." + "\n" + \
              "Check the evilcorp.html file in the materials folder.")
    return res

def createSoup():
    return bs4.BeautifulSoup(getPage(), 'html.parser')

def getScript():
    return"        hacked = function() {\n\
            alert('hacked');\n\
        }\n\
        window.addEventListener('load',\n\
          function() {\n\
            var f = document.querySelector(\"form\");\n\
            f.setAttribute(\"onsubmit\", \"hacked()\");\n\
          },\n\
          false\n\
        );\n\
"

def editHtmlEvel(soupEvel):
    soupEvel.title.string = "Evil Corp - Stealing your money every day"
    nameUser = soupEvel.find("span", {"class": "name"}).text.replace(' ', '')
    soupEvel.body.append(soupEvel.new_tag("h1"))
    soupEvel.body.h1.string = nameUser + ", you are hacked!"
    soupEvel.body.append(soupEvel.new_tag("script"))
    soupEvel.body.script.string = getScript()
    soupEvel.a["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"
    soupEvel.a.string = "Fsociety"
    
def saveNewEvelHtml(soupEvel):
    try:
        with open('../materials/evilcorp_hacked.html', 'w') as NewEvelHtml:
            NewEvelHtml.write(soupEvel.prettify())
    except Exception:
        print("File cannot be opened.")
    

def main():
    soupEvel = createSoup()
    if soupEvel != "":
        editHtmlEvel(soupEvel)
        saveNewEvelHtml(soupEvel)
    webbrowser.open('file:///C:/Users/User/Desktop/Python_Bootcamp.Day_03-1/materials/evilcorp_hacked.html')

if __name__ == "__main__":
    main()